{% extends 'quiz_play_contest_base.html' %}

{% block content %}
	
	<!-- Navigation bar --> 

	<nav id = "nav" class="navbar navbar-light" style="background-color: #34495E;">
	  		
	  	<a style="color: white; font-size: 12px;" href = "{% url 'home' %}" class = "navbar-brand" id = "home"> Home </span>
	  		
	  	<a style="color: white; font-size: 12px;" class = "navbar-brand" id="logout-button" href="{% url 'logout' %}"> Logout </a>
		
	</nav>

	<!-- Display question --> 

	<div id = "contest">

		<form method = "post" action = "{% url 'play_contest' %}?contest_id={{contest.id}}&question_id={{question.id}}">

			{% csrf_token %}

			<p>{{question.question}}</p>

			<input style = "float: right;" id = "time_taken" type = "hidden" name = "time_taken" value = "0" /> 

			{% if question.image %}

			<div id = "image-holder">

				<img name = "question-image" src = "{{question.image.url}}" width = "300" height = "200" /> 

			</div>

			{% endif %}

			{% for option in options %}

				<input type = "radio" id = "option" name = "answer" value = "{{option}}" />
				<label for = "option"> {{option}} </label> <br> 

			{% endfor %}

			<br>
			<br>

			<input id = "submit-button" type = "submit" name = "action" value = "Submit" /> 

		</form>

		<p id = "timer">0</p> 

	</div>

	<!-- JavaScript code to handle timer -->

	<script type="text/javascript">

		// Function to countdown till 20 seconds 
		
		var currentDate = new Date(); 
		var currentTime = $('#timer').html(); 

		function setTime()
		{
			currentTime = Number(currentTime) + 1; 

			// Set time 

			console.log('Current time = ' + currentTime); 

			$('#timer').html(currentTime);
			$('#time_taken').val(currentTime.toString(10)); 

			// Go to next question if timer exceeded 

			if(currentTime == 20)
			{
				console.log("Time limit exceeded."); 

				// Create a POST request and send it to server 

				const data = {answer: "", time_taken: "0000", csrfmiddlewaretoken: '{{csrf_token}}'}; 
				const URL = "{% url 'play_contest' %}?contest_id={{contest.id}}&question_id={{question.id}}"; 

				// Redirecting with a form submission
				
				var form = document.createElement('form'); 

				document.body.appendChild(form); 

				form.method = 'post';
				form.action = URL; 

				for(var name in data)
				{
					var input = document.createElement('input'); 

					input.type = 'hidden'; 
					input.name = name; 
					input.value = data[name]; 

					form.appendChild(input); 
				}

				form.submit();

				return; 
			} 

		}

		function countdownBegin()
		{
			setInterval(setTime, 1000);
		}
		
		// Entry point 

		$(document).ready(countdownBegin); 

		// Clear cache on submit 
		
		$("#submit-button").click(function()
		{
			// Clear storage time for next question 

			var newDate = new Date(); 

			$('#time_taken').val(newDate - currentDate); 
		}); 

	</script>

{% endblock %}